<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Clientes Sporteams</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #f6d365, #fda085);
  color: #333;
  padding: 20px;
}
h1, h2 { text-align: center; color: #f9546d; margin-bottom: 20px; }
#usuarioInfo { text-align: center; font-weight: bold; color: #007bff; margin-bottom: 20px; }

table {
  width: 100%; border-collapse: collapse; box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  margin-bottom: 30px; background-color: #fff; border-radius: 10px; overflow: hidden;
}
th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #ddd; }
th { background-color: #ff6b81; color: #fff; text-transform: uppercase; }
tr:nth-child(even) { background-color: #f1f1f1; }
tr:hover { background-color: #ffe5eb; }

form {
  max-width: 800px; margin: 0 auto 40px; padding: 25px; background-color: #ffffffcc;
  border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1);
  display: flex; flex-wrap: wrap; gap: 15px; justify-content: space-between;
}
form input { flex: 1 1 calc(50% - 20px); padding: 10px; border: 1px solid #ccc; border-radius: 8px; font-size: 16px; position:relative; }
form button {
  padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.3s; flex: 1 1 calc(48% - 20px);
}
form button[type="submit"] { background-color: #3fd362; color: #fff; }
form button[type="submit"]:hover { background-color: #218838; }
form button[type="button"] { background-color: #f66271; color: #fff; }
form button[type="button"]:hover { background-color: #f9606f; }

.table-btn { padding: 6px 12px; border: none; border-radius: 5px; margin-right: 5px; cursor: pointer; font-size: 0.9em; transition: 0.2s; }
.table-btn.edit { background-color: #f6d365; color: #1a1a1a; }
.table-btn.edit:hover { background-color: #f6d365; }
.table-btn.delete { background-color: #ff6b81; color: #fff; }
.table-btn.delete:hover { background-color: #ff6b81; }

#logoutBtn {
  background-color:#e389b5;color:white;padding:8px 12px;border:none;border-radius:5px;cursor:pointer; display:block; margin:0 auto 20px;
}

/* Cuadro de error */
.error-box {
  position: absolute;
  background-color: #ff6b81;
  color: #fff;
  padding: 4px 8px;
  font-size: 12px;
  border-radius: 5px;
  top: 38px;
  left: 0;
  display: none;
  z-index: 10;
}

input.valid { border-color: green; }
input.invalid { border-color: red; }

@media (max-width: 768px) {
  form input, form button { flex: 1 1 100%; }
  th, td { font-size: 0.9em; }
}
</style>
</head>
<body>

<h1>Lista de Clientes</h1>
<p id="usuarioInfo"></p>

<table>
  <thead>
    <tr>
      <th>ID</th><th>Nombre</th><th>Apellido</th><th>Documento</th><th>Teléfono</th>
      <th>Correo</th><th>Dirección</th><th>Fecha Registro</th><th>Acciones</th>
    </tr>
  </thead>
  <tbody id="clientes-table"></tbody>
</table>

<h2>Agregar / Editar Cliente</h2>
<form id="cliente-form">
  <input type="hidden" id="id_cliente">

  <div style="position:relative;">
    <input type="text" placeholder="Nombre" id="nombre" required>
    <div class="error-box" id="error-nombre">Solo se permiten letras</div>
  </div>

  <div style="position:relative;">
    <input type="text" placeholder="Apellido" id="apellido" required>
    <div class="error-box" id="error-apellido">Solo se permiten letras</div>
  </div>

  <div style="position:relative;">
    <input type="text" placeholder="Documento" id="documento" required>
    <div class="error-box" id="error-documento">Solo se permiten números</div>
  </div>

  <div style="position:relative;">
    <input type="text" placeholder="Teléfono" id="telefono" required>
    <div class="error-box" id="error-telefono">Solo se permiten números</div>
  </div>

  <input type="email" placeholder="Correo" id="correo">
  <input type="text" placeholder="Dirección" id="direccion">
  <button type="submit">Guardar</button>
  <button type="button" id="cancel-edit">Cancelar</button>
</form>

<button id="logoutBtn">Cerrar Sesión</button>

<script>
const user = JSON.parse(localStorage.getItem("usuario"));
if(!user) window.location.href="/login.html";
document.getElementById("usuarioInfo").innerText = `Usuario: ${user.nombre} | Rol: ${user.rol}`;

const tabla = document.getElementById("clientes-table");
const form = document.getElementById("cliente-form");
const cancelBtn = document.getElementById("cancel-edit");

// Inputs y mensajes
const nombreInput = document.getElementById("nombre");
const apellidoInput = document.getElementById("apellido");
const documentoInput = document.getElementById("documento");
const telefonoInput = document.getElementById("telefono");

const errorNombre = document.getElementById("error-nombre");
const errorApellido = document.getElementById("error-apellido");
const errorDocumento = document.getElementById("error-documento");
const errorTelefono = document.getElementById("error-telefono");

// Validar letras
function validarLetras(input, errorDiv){
  const val = input.value.trim();
  if(/[^a-zA-Z\s]/.test(val)){
    input.classList.add("invalid");
    input.classList.remove("valid");
    errorDiv.style.display="block";
    return false;
  }
  input.classList.add("valid");
  input.classList.remove("invalid");
  errorDiv.style.display="none";
  return true;
}

// Validar números
function validarNumeros(input, errorDiv){
  const val = input.value.trim();
  if(/[^0-9]/.test(val)){
    input.classList.add("invalid");
    input.classList.remove("valid");
    errorDiv.style.display="block";
    return false;
  }
  input.classList.add("valid");
  input.classList.remove("invalid");
  errorDiv.style.display="none";
  return true;
}

// Validación en tiempo real
nombreInput.addEventListener("input", ()=>validarLetras(nombreInput,errorNombre));
apellidoInput.addEventListener("input", ()=>validarLetras(apellidoInput,errorApellido));
documentoInput.addEventListener("input", ()=>validarNumeros(documentoInput,errorDocumento));
telefonoInput.addEventListener("input", ()=>validarNumeros(telefonoInput,errorTelefono));

// Cargar clientes
async function cargarClientes() {
  const res = await fetch("/api/clientes");
  const data = await res.json();
  tabla.innerHTML = "";
  data.forEach(cliente=>{
    tabla.innerHTML += `<tr>
      <td>${cliente.id_cliente}</td><td>${cliente.nombre}</td><td>${cliente.apellido}</td><td>${cliente.documento}</td>
      <td>${cliente.telefono}</td><td>${cliente.correo||""}</td><td>${cliente.direccion||""}</td>
      <td>${new Date(cliente.fecha_registro).toLocaleDateString()}</td>
      <td>
        <button class="table-btn edit" onclick="editarCliente(${cliente.id_cliente})">Editar</button>
        <button class="table-btn delete" onclick="eliminarCliente(${cliente.id_cliente})">Eliminar</button>
      </td>
    </tr>`;
  });
}
cargarClientes();

// Guardar cliente
form.addEventListener("submit", async e=>{
  e.preventDefault();
  if(!validarLetras(nombreInput,errorNombre) ||
     !validarLetras(apellidoInput,errorApellido) ||
     !validarNumeros(documentoInput,errorDocumento) ||
     !validarNumeros(telefonoInput,errorTelefono)) return;

  const id = document.getElementById("id_cliente").value;
  const cliente = {
    nombre: nombreInput.value.trim(),
    apellido: apellidoInput.value.trim(),
    documento: documentoInput.value.trim(),
    telefono: telefonoInput.value.trim(),
    correo: document.getElementById("correo").value.trim(),
    direccion: document.getElementById("direccion").value.trim()
  };

  if(id){
    await fetch(`/api/clientes/${id}`, {method:"PUT", headers:{"Content-Type":"application/json"}, body:JSON.stringify(cliente)});
  } else {
    await fetch("/api/clientes", {method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify(cliente)});
  }

  form.reset();
  document.getElementById("id_cliente").value="";
  cargarClientes();
});

cancelBtn.addEventListener("click", ()=>{ form.reset(); document.getElementById("id_cliente").value=""; });

window.editarCliente = async id=>{
  const res = await fetch("/api/clientes");
  const data = await res.json();
  const cliente = data.find(c=>c.id_cliente===id);
  if(!cliente) return;
  document.getElementById("id_cliente").value = cliente.id_cliente;
  nombreInput.value = cliente.nombre;
  apellidoInput.value = cliente.apellido;
  documentoInput.value = cliente.documento;
  telefonoInput.value = cliente.telefono;
  document.getElementById("correo").value = cliente.correo||"";
  document.getElementById("direccion").value = cliente.direccion||"";
}

window.eliminarCliente = async id=>{
  if(!confirm("¿Deseas eliminar este cliente?")) return;
  await fetch(`/api/clientes/${id}`, {method:"DELETE"});
  cargarClientes();
}

// Cerrar sesión
document.getElementById("logoutBtn").addEventListener("click", ()=>{
  localStorage.removeItem("usuario");
  window.location.href="/login.html";
});
</script>
</body>
</html>